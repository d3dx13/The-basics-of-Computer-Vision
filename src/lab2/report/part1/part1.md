**–ö–æ–Ω—Ñ–æ—Ä–º–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ** ‚Äî —ç—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º
—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ñ–æ—Ä–º–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –º–∞–ª—ã—Ö —Ñ–∏–≥—É—Ä –∏ —É–≥–ª—ã –º–µ–∂–¥—É –∫—Ä–∏–≤—ã–º–∏ –≤ —Ç–æ—á–∫–∞—Ö –∏—Ö –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è. –û—Å–Ω–æ–≤–Ω—ã–º–∏ –ª–∏–Ω–µ–π–Ω—ã–º–∏ –∫–æ–Ω—Ñ–æ—Ä–º–Ω—ã–º–∏
–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è–º–∏ —è–≤–ª—è—é—Ç—Å—è –µ–≤–∫–ª–∏–¥–æ–≤—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è. 
–ö –Ω–∏–º –æ—Ç–Ω–æ—Å—è—Ç—Å—è —Å–¥–≤–∏–≥, –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ, –æ–¥–Ω–æ—Ä–æ–¥–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–≤–æ—Ä–æ—Ç.
–ö–æ–Ω—Ñ–æ—Ä–º–Ω—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —è–≤–ª—è—é—Ç—Å—è –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –∞—Ñ—Ñ–∏–Ω–Ω—ã—Ö
–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π.

–í OpenCV –∞—Ñ–∏–Ω–Ω—ã–µ –ø—Ä—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–µ–ª–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ **warpAffine**


```python
import cv2
import numpy as np
from matplotlib import pyplot as plt
from matplotlib.pyplot import figure
from numba import njit, jit
from math import *
import warnings
warnings.filterwarnings('ignore')
export_parallel = True
use_graph = True
```


```python
# –°—á–∏—Ç–∞—é –∏—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
image = cv2.imread("data/plane.jpg")
```


```python
# –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ 2400 –Ω–∞ 1538 –ø–∏–∫—Å–µ–ª–µ–π –∏ 3 –∫–∞–Ω–∞–ª–∞ BGR
print(image.shape)
```

    (1538, 2400, 3)



```python
# –ò—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_4_0.png)
‚Äã    


### –õ–∏—Å—Ç–∏–Ω–≥ 1.1. –°–¥–≤–∏–≥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ 500 –∏ 200 –ø–∏–∫—Å–µ–ª–µ–π –ø–æ –æ—Å—è–º ùëÇùë• –∏ ùëÇùë¶ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ. 


```python
M = np.array([[1, 0, 500],
              [0, 1, 200]], dtype=np.float64)
print(M)
image_moved = cv2.warpAffine(image, M, (image.shape[0:2])[::-1])
```

    [[  1.   0. 500.]
     [  0.   1. 200.]]



```python
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image_moved, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_7_0.png)
‚Äã    


### –õ–∏—Å—Ç–∏–Ω–≥ 1.2. –û—Ç—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –æ—Å–∏ ùëÇy.

–¢–∞–∫ –∫–∞–∫ –≤ OpenCV –ø–æ —É—Å–æ–ª—á–∞–Ω–∏—é —Ü–µ–Ω—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É, 
—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω—É–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–º–µ—Å—Ç–∏—Ç—å –≤ —Ü–µ–Ω—Ç—Ä. –û–±—ã—á–Ω–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–µ–ª–∞—é—Ç —ç—Ç–æ —Å–∞–º–∏, 
–Ω–æ –µ—Å–ª–∏ –ø–∏—Å–∞—Ç—å –º–∞—Ç—Ä–∏—Ü—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤—Ä—É—á–Ω—É—é, —Ç–æ–≥–¥–∞ –ø—Ä–∏–¥—ë—Ç—Å—è —ç—Ç–æ –ø–æ–º–Ω–∏—Ç—å.


```python
M = np.array([[-1, 0, image.shape[1]],
              [0, 1, 0]], dtype=np.float64)
print(M)
image_mirrored = cv2.warpAffine(image, M, (image.shape[0:2])[::-1])

```

    [[-1.0e+00  0.0e+00  2.4e+03]
     [ 0.0e+00  1.0e+00  0.0e+00]]



```python
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image_mirrored, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_10_0.png)
‚Äã    


### –õ–∏—Å—Ç–∏–Ω–≥ 1.3. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –¥–≤–∞ —Ä–∞–∑–∞.

–ü–æ–∫–∞–∂—É, –∫–∞–∫ –º–æ–∂–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º–∏.


```python
center = (image.shape[1] / 2, image.shape[0] / 2)
pts1 = np.array([[center[0], center[1]], 
                      [center[0] + 100, center[1] + 100], 
                      [center[0] + 100, center[1] - 100]], 
                     dtype=np.float32)
pts2 = np.array([[center[0], center[1]], 
                      [center[0] + 200, center[1] + 200], 
                      [center[0] + 200, center[1] - 200]], 
                     dtype=np.float32)
M = cv2.getAffineTransform(pts1, pts2)
print(M)
image_scaled = cv2.warpAffine(image, M, (image.shape[0:2])[::-1])
```

    [[ 2.00000000e+00 -0.00000000e+00 -1.20000000e+03]
     [ 7.87062723e-16  2.00000000e+00 -7.69000000e+02]]



```python
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image_scaled, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_13_0.png)
‚Äã    


### –õ–∏—Å—Ç–∏–Ω–≥ 1.4. –ü–æ–≤–æ—Ä–æ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ ùúô = 37 –≥—Ä–∞–¥—É—Å–æ–≤


```python
center = (image.shape[1] / 2, image.shape[0] / 2)
M = cv2.getRotationMatrix2D(center, 37, 1)
print(M)
image_rotated = cv2.warpAffine(image, M, (image.shape[0:2])[::-1])
```

    [[ 7.98635510e-01  6.01815023e-01 -2.21158365e+02]
     [-6.01815023e-01  7.98635510e-01  8.77027321e+02]]



```python
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image_rotated, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_16_0.png)
‚Äã    


–ê—Ñ—Ñ–∏–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –ø—Ä—è–º—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –ø—Ä—è–º—ã–µ, –ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏–µ—Å—è
 –≤ –ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏–µ—Å—è, —Å–∫—Ä–µ—â–∏–≤–∞—é—â–∏–µ—Å—è –≤ —Å–∫—Ä–µ—â–∏–≤–∞—é—â–∏–µ—Å—è; —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –æ—Ç–Ω–æ—à–µ–Ω–∏—è –¥–ª–∏–Ω –æ—Ç—Ä–µ–∑–∫–æ–≤, –ª–µ–∂–∞—â–∏—Ö –Ω–∞ –æ–¥–Ω–æ–π –ø—Ä—è–º–æ–π 
 (–∏–ª–∏ –Ω–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä—è–º—ã—Ö), –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –ø–ª–æ—â–∞–¥–µ–π —Ñ–∏–≥—É—Ä.

–ë–∞–∑–æ–≤—ã–º–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è–º–∏ —è–≤–ª—è—é—Ç—Å—è –∫–æ–Ω—Ñ–æ—Ä–º–Ω—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è, —Å–∫–æ—Å –∏ –Ω–µ–æ–¥–Ω–æ—Ä–æ–¥–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ. –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ –∞—Ñ—Ñ–∏–Ω–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∏ –ø–æ–º–æ—â–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –º–∞—Ç—Ä–∏—Ü –±–∞–∑–æ–≤—ã—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π. –í –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π
–≥–µ–æ–º–µ—Ç—Ä–∏–∏ –ª—é–±–æ–µ –∞—Ñ—Ñ–∏–Ω–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏–º–µ–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ–µ –∞—Ñ—Ñ–∏–Ω–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä—è–º–æ–≥–æ –∏ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –¥–∞–µ—Ç –µ–¥–∏–Ω–∏—á–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—Å–µ —Ç–æ—á–∫–∏ –Ω–∞ –º–µ—Å—Ç–µ. –ê—Ñ—Ñ–∏–Ω–Ω—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —è–≤–ª—è—é—Ç—Å—è –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –ø—Ä–æ–µ–∫—Ü–∏–æ–Ω–Ω—ã—Ö
–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π.

### –õ–∏—Å—Ç–∏–Ω–≥ 2.5. –°–∫–æ—Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, ùë† = 0.5.


```python
M = np.array([[1, 0.5, 0],
              [0, 1, 0]], dtype=np.float64)
image_beveled = cv2.warpAffine(image, M, (image.shape[0:2])[::-1])
```


```python
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image_beveled, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_20_0.png)
‚Äã    


### –õ–∏—Å—Ç–∏–Ω–≥ 2.6. –ö—É—Å–æ—á–Ω–æ-–ª–∏–Ω–µ–π–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

–õ–µ–≤–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, 
–∞ –ø—Ä–∞–≤–∞—è —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –≤ –¥–≤–∞ —Ä–∞–∑–∞ –≤–¥–æ–ª—å –æ—Å–∏ ùëÇùë• –≤ 2.7 —Ä–∞–∑–∞.


```python
stretch = 2.7
image_splited = np.hsplit(image, 2)
left_image, right_image = image_splited[0], image_splited[1]
M = np.array([[stretch, 0, 0],
              [0, 1, 0]], dtype=np.float64)
right_image = cv2.warpAffine(right_image, M, (right_image.shape[0:2])[::-1])
image_concated = np.concatenate((left_image, right_image), axis=1)
```


```python
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image_concated, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_23_0.png)
‚Äã    


### –õ–∏—Å—Ç–∏–Ω–≥ 2.7. –ü—Ä–æ–µ–∫—Ü–∏–æ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ.

**–ù–µ–ª–∏–Ω–µ–π–Ω—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è**

–ü—Ä–∏ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏ –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω—ã –ø—Ä–∏ –ø–æ–º–æ—â–∏ –∏–¥–µ–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏ 
–∫–∞–º–µ—Ä—ã. –í –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ—Ç—Å—è —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –Ω–µ–ª–∏–Ω–µ–π–Ω—ã–º–∏ –∏—Å–∫–∞–∂–µ–Ω–∏—è–º–∏. 
–î–ª—è –∏—Ö –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ –Ω–µ–ª–∏–Ω–µ–π–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.

**–ü—Ä–æ–µ–∫—Ü–∏–æ–Ω–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ**

–ü—Ä–æ–µ–∫—Ü–∏–æ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä—è–º—ã–µ –ª–∏–Ω–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä—è–º—ã–º–∏ –ª–∏–Ω–∏—è–º–∏, –æ–¥–Ω–∞–∫–æ –≥–µ–æ–º–µ—Ç—Ä–∏—è —Ñ–∏–≥—É—Ä—ã 
–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∞, —Ç.–∫. –¥–∞–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –æ–±—â–µ–º —Å–ª—É—á–∞–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏ –ª–∏–Ω–∏–π. –°–≤–æ–π—Å—Ç–≤–æ–º, —Å–æ—Ö—Ä–∞–Ω—è—é—â–∏–º—Å—è 
–ø—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∏–≤–Ω–æ–º –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏, —è–≤–ª—è–µ—Ç—Å—è –∫–æ–ª–ª–∏–Ω–µ–∞—Ä–Ω–æ—Å—Ç—å —Ç–æ—á–µ–∫: —Ç—Ä–∏ —Ç–æ—á–∫–∏, –ª–µ–∂–∞—â–∏–µ –Ω–∞ –æ–¥–Ω–æ–π –ø—Ä—è–º–æ–π (–∫–æ–ª–ª–∏–Ω–µ–∞—Ä–Ω—ã–µ), –ø–æ—Å–ª–µ
–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ –æ–¥–Ω–æ–π –ø—Ä—è–º–æ–π. –ü—Ä–æ–µ–∫—Ü–∏–æ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–∞–∫ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º (–∏–∑–º–µ–Ω—è–µ—Ç—Å—è –º–∞—Å—à—Ç–∞–±), 
—Ç–∞–∫ –∏ –ø—Ä–æ–µ–∫—Ç–∏–≤–Ω—ã–º (–∏–∑–º–µ–Ω—è–µ—Ç—Å—è –≥–µ–æ–º–µ—Ç—Ä–∏—è —Ñ–∏–≥—É—Ä—ã).


```python
rows,cols,ch = image.shape
M = np.array([[1.25, 0.27, 0],
              [0.44, 1.3, 0],
              [0.008, 0.0012, 1]], dtype=np.float64)
M = M.transpose()
print(M)

image_projection = cv2.warpPerspective(image, M, (int(cols * 1.5), int(rows * 1.6)))
```

    [[1.25e+00 4.40e-01 8.00e-03]
     [2.70e-01 1.30e+00 1.20e-03]
     [0.00e+00 0.00e+00 1.00e+00]]



```python
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image_projection, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_26_0.png)
‚Äã    


### –õ–∏—Å—Ç–∏–Ω–≥ 2.8. –ü–æ–ª–∏–Ω–æ–º–∏–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

**–ü–æ–ª–∏–Ω–æ–º–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ**

–ü–æ–ª–∏–Ω–æ–º–∏–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é –ø–æ–ª–∏–Ω–æ–º–æ–≤. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –º–∞—Ç—Ä–∏—Ü–∞ 
–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç ùëá –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –ø–æ–ª–∏–Ω–æ–º–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–æ—Ä—è–¥–∫–æ–≤ –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç ùë• –∏ ùë¶. 


```python
"""
{
    Ô∏Éùë•‚Ä≤ = ùëé0 + ùëé1ùë• + ùëé2ùë¶ + ùëé3ùë•^2 + ùëé4ùë•ùë¶ + ùëé5ùë¶^2,
    ùë¶‚Ä≤ = ùëè0 + ùëè1ùë• + ùëè2ùë¶ + ùëè3ùë•^2 + ùëè4ùë•ùë¶ + ùëè5ùë¶^2,
}
"""
def apply_polynomial_transform(a, b, image, center=None):
    height, width = image.shape[:2]
    if center is None:
        center = np.array((width / 2, height / 2))
    coords = np.indices((width, height)).reshape(2, -1)
    grid = np.vstack((coords, np.ones(coords.shape[1]))).astype(np.float64)
    points1 = np.array([grid[0], grid[1]], dtype=np.float64)
    points1[0] -= center[0]
    points1[1] -= center[1]
    points2 = [None, None]
    
    points2[0] = a[0] + \
                 a[1] * points1[0] + \
                 a[2] * points1[1] + \
                 a[3] * (points1[0] ** 2) + \
                 a[4] * np.multiply(points1[0], points1[1]) + \
                 a[5] * (points1[1] ** 2)
    points2[1] = b[0] + \
                 b[1] * points1[0] + \
                 b[2] * points1[1] + \
                 b[3] * (points1[0] ** 2) + \
                 b[4] * np.multiply(points1[0], points1[1]) + \
                 b[5] * (points1[1] ** 2)
    
    points1[0] += center[0]
    points1[1] += center[1]
    points2[0] += center[0]
    points2[1] += center[1]
    
    points1 = [np.round(points1[0]).astype(dtype=np.int64), np.round(points1[1]).astype(dtype=np.int64)]
    points2 = [np.round(points2[0]).astype(dtype=np.int64), np.round(points2[1]).astype(dtype=np.int64)]
    indices = np.where((points2[0] >= 0) & (points2[0] < width) &
                   (points2[1] >= 0) & (points2[1] < height))
    points1 = np.array([points1[0][indices], points1[1][indices]])
    points2 = np.array([points2[0][indices], points2[1][indices]])
    image_new = np.zeros_like(image)
    image_new[points2[1], points2[0]] = image[points1[1], points1[0]]
    return image_new
```


```python
height, width = image.shape[:2]
tx, ty = np.array((width // 2, height // 2))
if use_graph:
    image_polynomial = apply_polynomial_transform(
    np.array([0, 0.8, 0.1, 0.0001, -0.0005, 0.0009]), 
    np.array([0, 0.2, 1.2, 0.0004, 0.0002, -0.0007]), 
    image, (tx, ty))
```


```python
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image_polynomial, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_30_0.png)
‚Äã    


–ö–∞–∫ –≤–∏–¥–Ω–æ, —Å–∞–º–æ–ª—ë—Ç –∏—Å–∫–∞–∑–∏–ª–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º –æ–±—Ä–∞–∑–æ–º. 
–ú–æ–∂–Ω–æ –¥–æ–ª–≥–æ–∏–≥—Ä–∞—Ç—å—Å—è —Å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º–∏ –∏ –ø–æ–ª—É—á–∞—Ç—å –≤—Å—ë –±–æ–ª–µ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∏—Å–∫–∞–∂–µ–Ω–∏—è.

–¢–∞–∫–∂–µ —è –ø—ã—Ç–∞–ª—Å—è —Å–≥–ª–∞–¥–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –∏ —Å–∞–º—ã–º –ø—Ä–æ—Å—Ç—ã–º —Å–ø–æ—Å–æ–±–æ–º –±—ã–ª–æ –±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ,
–Ω–æ —è –Ω–µ –∑–Ω–∞—é, –∫–∞–∫ –ø–ª—Å—á–∏—Ç–∞—Ç—å –µ–≥–æ –æ—Ç –Ω–µ–ª–∏–Ω–µ–π–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏. –ú–µ—Ç–æ–¥—ã —á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ,
—á—Ç–æ–±—ã —Å—á–∏—Ç–∞—Ç—å —ç—Ç–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–ª–ª–∏–æ–Ω–æ–≤ —Ä–∞–∑.

### –õ–∏—Å—Ç–∏–Ω–≥ 2.9. –°–∏–Ω—É—Å–æ–∏–¥–∞–ª—å–Ω–æ–µ –∏—Å–∫–∞–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

–í –∫–∞—á–µ—Å—Ç–≤–µ –µ—â–µ –æ–¥–Ω–æ–≥–æ –∏–∑ –ø—Ä–∏–º–µ—Ä–æ–≤ –Ω–µ–ª–∏–Ω–µ–π–Ω–æ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
–º–æ–∂–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≥–∞—Ä–º–æ–Ω–∏—á–µ—Å–∫–æ–µ –∏—Å–∫–∞–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.


```python
"""
{
    ùë•‚Ä≤ = a0 * ùë• + a1 * sin (a2 * pi * ùë¶),
    ùë¶‚Ä≤ = b0 * ùë¶ + b1 * sin (b2 * pi * x),
}
"""
def apply_sin_transform(a, b, image, center=None):
    height, width = image.shape[:2]
    if center is None:
        center = np.array((width / 2, height / 2))
    coords = np.indices((width, height)).reshape(2, -1)
    grid = np.vstack((coords, np.ones(coords.shape[1]))).astype(np.float64)
    points1 = np.array([grid[0], grid[1]], dtype=np.float64)
    points1[0] -= center[0]
    points1[1] -= center[1]
    points2 = [None, None]
    
    points2[0] = a[0] * points1[0] + \
                 a[1] * np.sin(a[2] * np.pi * points1[1])
    points2[1] = b[0] * points1[1] + \
                 b[1] * np.sin(b[2] * np.pi * points1[0])
    
    points1[0] += center[0]
    points1[1] += center[1]
    points2[0] += center[0]
    points2[1] += center[1]
    
    points1 = [np.round(points1[0]).astype(dtype=np.int64), np.round(points1[1]).astype(dtype=np.int64)]
    points2 = [np.round(points2[0]).astype(dtype=np.int64), np.round(points2[1]).astype(dtype=np.int64)]
    indices = np.where((points2[0] >= 0) & (points2[0] < width) &
                   (points2[1] >= 0) & (points2[1] < height))
    points1 = np.array([points1[0][indices], points1[1][indices]])
    points2 = np.array([points2[0][indices], points2[1][indices]])
    image_new = np.zeros_like(image)
    image_new[points2[1], points2[0]] = image[points1[1], points1[0]]
    return image_new
```


```python
height, width = image.shape[:2]
tx, ty = np.array((width // 2, height // 2))
if use_graph:
    image_vsin = apply_sin_transform(
    np.array([1, 100, 0.005]), 
    np.array([1, 30, 0.004]), 
    image, (tx, ty))
```


```python
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image_vsin, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()

```


‚Äã    
![png](output_35_0.png)
‚Äã    


### –õ–∏—Å—Ç–∏–Ω–≥ 2.10. –ù–∞–ª–æ–∂–µ–Ω–∏–µ –±–æ—á–∫–æ–æ–±—Ä–∞–∑–Ω–æ–π –¥–∏—Å—Ç–æ—Ä–∏–∏–∏ 5 –ø–æ—Ä—è–¥–∫–∞.

**–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–∏—Å—Ç–æ—Ä—Å–∏–∏**

–ü—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–ø—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Å—Ç–µ–º–æ–π –Ω–∞ –Ω–µ–º
–º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –¥–∏—Å—Ç–æ—Ä—Å–∏—è. –î–∏—Å—Ç–æ—Ä—Å–∏—è ‚Äî —ç—Ç–æ –æ–ø—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–∫–∞–∂–µ–Ω–∏–µ, –≤—ã—Ä–∞–∂–∞—é—â–µ–µ—Å—è –≤ –∏—Å–∫—Ä–∏–≤–ª–µ–Ω–∏–∏ –ø—Ä—è–º—ã—Ö –ª–∏–Ω–∏–π. 
–°–≤–µ—Ç–æ–≤—ã–µ –ª—É—á–∏, –ø—Ä–æ—Ö–æ–¥—è—â–∏–µ —á–µ—Ä–µ–∑ —Ü–µ–Ω—Ç—Ä –ª–∏–Ω–∑—ã —Å—Ö–æ–¥—è—Ç—Å—è –≤ —Ç–æ—á–∫–µ, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ–π –¥–∞–ª—å—à–µ –æ—Ç –ª–∏–Ω–∑—ã, —á–µ–º –ª—É—á–∏, –ø—Ä–æ—Ö–æ–¥—è—â–∏–µ 
—á–µ—Ä–µ–∑ –µ–µ –∫—Ä–∞—è. –ü—Ä—è–º—ã–µ –ª–∏–Ω–∏–∏ –∏—Å–∫–∫—Ä–∏–≤–ª—è—é—Ç—Å—è –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º —Ç–µ—Ö, –∫–æ—Ç–æ—Ä—ã–µ –ª–µ–∂–∞—Ç –≤ –æ–¥–Ω–æ–π –ø–ª–æ—Å–∫–æ—Å—Ç–∏ —Å –æ–ø—Ç–∏—á–µ—Å–∫–æ–π –æ—Å—å—é. 
–ù–∞–ø—Ä–∏–º–µ—Ä, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–≤–∞–¥—Ä–∞—Ç–∞, —Ü–µ–Ω—Ç—Ä –∫–æ—Ç–æ—Ä–æ–≥–æ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç –æ–ø—Ç–∏—á–µ—Å–∫–∞—è –æ—Å—å, –∏–º–µ–µ—Ç –≤–∏–¥ –ø–æ–¥—É—à–∫–∏ (–ø–æ–¥—É—à–∫–æ–æ–±—Ä–∞–∑–Ω–∞—è –¥–∏—Å—Ç–æ—Ä—Å–∏—è) 
–ø—Ä–∏ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π –¥–∏—Å—Ç–æ—Ä—Å–∏–∏ –∏ –≤–∏–¥ –±–æ—á–∫–∏ (–±–æ—á–∫–æ–æ–±—Ä–∞–∑–Ω–∞—è –¥–∏—Å—Ç–æ—Ä—Å–∏—è) –ø—Ä–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π –¥–∏—Å—Ç–æ—Ä—Å–∏–∏.

–†–∞–¥–∏–∞–ª—å–Ω—É—é –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏—é –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

x_distorted = x * (1 + k1*r^2 + k2*r^4 + k3*r^6)

y_distorted = y * (1 + k1*r^2 + k2*r^4 + k3*r^6)

–¢–æ—á–Ω–æ —Ç–∞–∫ –∂–µ —Ç–∞–Ω–≥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ –∏—Å–∫–∞–∂–µ–Ω–∏–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ –ª–∏–Ω–∑–∞ –¥–ª—è —Å—ä–µ–º–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –≤—ã—Ä–æ–≤–Ω–µ–Ω–∞ –∏–¥–µ–∞–ª—å–Ω–æ 
–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –ø–ª–æ—Å–∫–æ—Å—Ç–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–±–ª–∞—Å—Ç–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–≥—É—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –±–ª–∏–∂–µ, —á–µ–º –æ–∂–∏–¥–∞–ª–æ—Å—å. 
–í–µ–ª–∏—á–∏–Ω—É —Ç–∞–Ω–≥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∏—Å–∫–∞–∂–µ–Ω–∏—è –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

x_distorted = x + (2*p1*x*y + p2*(r2 + 2x2))

y_distorted = y + (p1*(r2 + 2y2) + 2*p2*x*y)


```python
image = cv2.imread("data/oil.jpg")

# –ù–æ–≤–æ–µ –∏—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_37_0.png)
‚Äã    



```python
h, w = image.shape[:2]
mtx =  np.array([[min(w, h), 0, w / 2],
                 [0, min(w, h), h / 2],
                 [0, 0, 1]])
k1 = 0.4
k2 = 0.8
k3 = 0.9
p1 = 0
p2 = 0
dist = np.array([k1, k2, p1, p2, k3])
image_barel = cv2.undistort(image, mtx, dist)
```


```python
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image_barel, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_39_0.png)
‚Äã    


### –õ–∏—Å—Ç–∏–Ω–≥ 2.11. –ù–∞–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥—É—à–∫–æ–æ–±—Ä–∞–∑–Ω–æ–π –¥–∏—Å—Ç–æ—Ä–∏–∏–∏ 3 –ø–æ—Ä—è–¥–∫–∞.


```python
image = cv2.imread("data/Fisheye_photo.jpg")

# –ù–æ–≤–æ–µ –∏—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_41_0.png)
‚Äã    



```python
h, w = image.shape[:2]
mtx =  np.array([[min(w, h), 0, w / 2],
                 [0, min(w, h), h / 2],
                 [0, 0, 1]])
k1 = -0.4
k2 = -0.8
k3 = 0
p1 = 0
p2 = 0
dist = np.array([k1, k2, p1, p2, k3])
image_pillow = cv2.undistort(image, mtx, dist)
```


```python
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image_pillow, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


![png](output_43_0.png)
    


### –õ–∏—Å—Ç–∏–Ω–≥ 2.12. "–°–∫–ª–µ–π–∫–∞" –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π



```python
import os

# –°—á–∏—Ç–∞—é –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
images = []
for image_name in os.listdir('data/stitch'):
    image = cv2.imread('data/stitch/' + image_name)
    if image is None:
        continue
    images.append(image)
```


```python
if use_graph:
    for image in images:
        figure(figsize=(32, 16), dpi=80)
        plt.imshow(cv2.cvtColor(image, cv2.COLOR_BGR2RGB))
        plt.xticks([]),plt.yticks([])
        plt.show()
```


‚Äã    
![png](output_46_0.png)
‚Äã    




![png](output_46_1.png)
    




![png](output_46_2.png)
    




![png](output_46_3.png)
    



```python
if use_graph:
    stitcher = cv2.Stitcher.create(cv2.Stitcher_SCANS)
    status, pano = stitcher.stitch(images)
    if status != cv2.Stitcher_OK:
        print("Can't stitch images, error code = %d" % status)
```


```python
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(pano, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_48_0.png)
‚Äã    


–ö–∞–∫ –≤–∏–¥–Ω–æ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∫–ª–µ–π–∫–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø—à–Ω–æ, –Ω–æ –∑–∞–Ω—è–ª–∞ —Ü–µ–ª—ã–µ 10 —Å–µ–∫—É–Ω–¥.

