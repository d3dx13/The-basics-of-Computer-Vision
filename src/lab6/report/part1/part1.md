### –õ–∏—Å—Ç–∏–Ω–≥ 1. –ë–∞–∑–æ–≤—ã–µ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

–¢–µ—Ä–º–∏–Ω –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—è –¥–æ—Å–ª–æ–≤–Ω–æ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –∫–∞–∫ ¬´–Ω–∞—É–∫–∞ –æ —Ñ–æ—Ä–º–µ¬ª.
–ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –º–Ω–æ–≥–∏—Ö –æ–±–ª–∞—Å—Ç—è—Ö –∑–Ω–∞–Ω–∏–π,
–≤ —Ç.—á. –∏ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —è–≤–ª—è–µ—Ç—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º,
–ø–æ—ç—Ç–æ–º—É —Å—Ç–æ–∏—Ç –æ–±–æ—Å–æ–±–ª–µ–Ω–Ω–æ –æ—Ç –≤—Å–µ—Ö —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö —Ä–∞–Ω–µ–µ –º–µ—Ç–æ–¥–æ–≤. –° –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –º–æ–∂–Ω–æ –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —à—É–º–æ–≤, —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é –æ–±—ä–µ–∫—Ç–æ–≤, –≤—ã–¥–µ–ª–µ–Ω–∏–µ
–∫–æ–Ω—Ç—É—Ä–æ–≤, —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏,
–≤—ã—á–∏—Å–ª–∏—Ç—å ¬´—Å–∫–µ–ª–µ—Ç¬ª –æ–±—Ä–∞–∑–∞ –∏ —Ç.–¥. 

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
–±–∏–Ω–∞—Ä–Ω–æ–π –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏ –Ω–∞–¥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º A —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º B:

1. –î–∏–ª–∞—Ç–∞—Ü–∏—è (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ, –Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ): ùê¥ ‚äï ùêµ, 
—Ä–∞—Å—à–∏—Ä—è–µ—Ç –±–∏–Ω–∞—Ä–Ω—ã–π –æ–±—Ä–∞–∑ ùê¥ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º ùêµ;

2. –≠—Ä–æ–∑–∏—è (—Å–∂–∞—Ç–∏–µ, —Å—É–∂–µ–Ω–∏–µ): ùê¥ ‚äñ ùêµ, —Å—É–∂–∞–µ—Ç –±–∏–Ω–∞—Ä–Ω—ã–π –æ–±—Ä–∞–∑ ùê¥ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º ùêµ;

3. –û—Ç–∫—Ä—ã—Ç–∏–µ (–æ—Ç–º—ã–∫–∞–Ω–∏–µ, —Ä–∞–∑–º—ã–∫–∞–Ω–∏–µ, —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ): (ùê¥ ‚äñ ùêµ) ‚äï ùêµ, 
—É–¥–∞–ª—è–µ—Ç –≤–Ω–µ—à–Ω–∏–µ –¥–µ—Ñ–µ–∫—Ç—ã –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ ùê¥ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º ùêµ;

4. –ó–∞–∫—Ä—ã—Ç–∏–µ (–∑–∞–º—ã–∫–∞–Ω–∏–µ): (ùê¥ ‚äï ùêµ) ‚äñ ùêµ, 
—É–¥–∞–ª—è–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –¥–µ—Ñ–µ–∫—Ç—ã –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ ùê¥ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º ùêµ.

–≥–¥–µ ‚äï –∏ ‚äñ ‚Äî —Å–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã—á–∏—Ç–∞–Ω–∏–µ –ú–∏–Ω–∫–æ–≤—Å–∫–æ–≥–æ, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.


```python
import imutils
import cv2
import os
import skimage.color
import skimage.segmentation
import skimage.measure
import skimage.feature
import skimage.morphology
import scipy.ndimage
import numpy as np
from matplotlib import pyplot as plt
from matplotlib.pyplot import figure
import warnings
warnings.filterwarnings('ignore')
export_parallel = True
use_graph = True
```


```python
# –ò—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
image = cv2.imread("data/oranges.jpg")
```

–ü–æ–ø—Ä–æ–±—É—é –≤—ã–¥–µ–ª–∏—Ç—å –ø–æ —Ü–≤–µ—Ç—É –∞–ø–µ–ª—å—Å–∏–Ω—ã –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏.


```python
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_4_0.png)
‚Äã    



```python
# –ü–µ—Ä–µ–≤–æ–¥ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ HSV
image = cv2.cvtColor(np.float32(image / 255.0), cv2.COLOR_BGR2HSV)

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ì–∞—É—Å—Å—É
image = cv2.GaussianBlur(image, (5, 5), 1)

# –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å–∫–∏
image_mask = np.logical_and(
    np.logical_or(image[:,:,0] < 50.0, image[:,:,0] > 345.0), # Hue < 50 or Hue > 345
    np.logical_and(
        image[:,:,1] > 0.4, # Saturation > 0.3
        image[:,:,2] > 0.4, # Lightness > 0.25
    )
)
```


```python
# –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(cv2.bitwise_and(image, image, mask=np.uint8(image_mask * 255)), cv2.COLOR_HSV2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_6_0.png)
‚Äã    



```python
# –û—Ç–∫—Ä—ã—Ç–∏–µ (–æ—Ç–º—ã–∫–∞–Ω–∏–µ, —Ä–∞–∑–º—ã–∫–∞–Ω–∏–µ, —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ): (ùê¥ ‚äñ ùêµ) ‚äï ùêµ
selem = skimage.morphology.disk(7)
image_mask = skimage.morphology.erosion(image_mask, selem)
image_mask = skimage.morphology.dilation(image_mask, selem)

# –ó–∞–∫—Ä—ã—Ç–∏–µ (–∑–∞–º—ã–∫–∞–Ω–∏–µ): (ùê¥ ‚äï ùêµ) ‚äñ ùêµ
selem = skimage.morphology.disk(11)
image_mask = skimage.morphology.dilation(image_mask, selem)
image_mask = skimage.morphology.erosion(image_mask, selem)

# –ù–∞—Ö–æ–¥–∏—Ç –Ω–∞–±–æ—Ä —ç—Ç–æ –Ω–∞–±–æ—Ä –ø–∏–∫—Å–µ–ª–µ–π, –≤—Ö–æ–¥—è—â–∏—Ö –≤ –Ω–∞–∏–º–µ–Ω—å—à–∏–π –≤—ã–ø—É–∫–ª—ã–π –º–Ω–æ–≥–æ—É–≥–æ–ª—å–Ω–∏–∫, 
# –∫–æ—Ç–æ—Ä—ã–π –æ–∫—Ä—É–∂–∞–µ—Ç –≤—Å–µ –±–µ–ª—ã–µ –ø–∏–∫—Å–µ–ª–∏ –≤—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è. 
# –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–µ—Å–≤—è–∑–Ω–æ–≥–æ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∫–∏–ø—Å–µ–ª–µ–π
image_mask = skimage.morphology.convex_hull_object(image_mask)
```


```python
# –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    image_to_show = cv2.bitwise_and(image, image, mask=np.uint8(image_mask * 255))
    plt.imshow(cv2.cvtColor(image_to_show, cv2.COLOR_HSV2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_8_0.png)
‚Äã    


–†–µ–∑—É–ª—å—Ç–∞—Ç —Ö–æ—Ä–æ—à–∏–π, –Ω–æ —á–∞—Å—Ç–∏—á–Ω–æ –≤–∏–¥–∏–º—ã–π –∞–ø–µ–ª—å—Å–∏–Ω —Å–ø—Ä–∞–≤–∞ —Å–≤–µ—Ä–∑—É —Ä–∞—Å–ø–∞–ª—Å—è –Ω–∞ 2 —á–∞—Å—Ç–∏, 
—Ö–æ—Ç—è —Ä–∞—Å–ø–æ–∑–Ω–∞–ª—Å—è –∞–ø–µ–ª—å—Å–∏–Ω, –¥–∞–∂–µ —Å–∏–ª—å–Ω–æ –ø–µ—Ä–µ–∫—Ä—ã—Ç—ã–π –¥–µ—Ä–µ–≤–æ–º —Å–ø—Ä–∞–≤–∞ —Å–Ω–∏–∑—É.

### –õ–∏—Å—Ç–∏–Ω–≥ 2. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ ¬´—Å–∫–ª–µ–µ–Ω–Ω—ã—Ö¬ª –æ–±—ä–µ–∫—Ç–æ–≤

–û–¥–Ω–∏–º –∏–∑ –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
–Ω–∞–¥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–¥–∞—á–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Å–∫–ª–µ–∏–≤—à–∏—Ö—Å—è –Ω–∞
–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤. –ó–∞–¥–∞—á–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ—à–µ–Ω–∞ —Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π 
—Å—Ç–µ–ø–µ–Ω—å—é —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –ø–æ–º–æ—â–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–∞–∑ —Ñ–∏–ª—å—Ç—Ä–∞ —Å–∂–∞—Ç–∏—è, –∞ –∑–∞—Ç–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ
—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞. –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è 
—Å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º –ø–æ–∑–≤–æ–ª–∏—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç—å —Å–∫–ª–µ–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã.


```python
# –ò—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
image = cv2.imread("data/coins.jpg")
```

–ù–∞ —Å–ª–µ–¥—É—é—â–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –±—É–¥–µ—Ç –∑–∞–¥–∞—á–∞ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –Ω–µ–ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏–µ—Å—è –æ–±–ª–∞—Å—Ç–∏.


```python
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_13_0.png)
‚Äã    



```python
# –ü–µ—Ä–µ–≤–æ–¥ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ HSV
image = cv2.cvtColor(np.float32(image / 255.0), cv2.COLOR_BGR2HSV)

# –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å–∫–∏
image_mask = image[:,:,1] > 0.15 # Saturation > 0.1
```


```python
# –í–∏–¥ –º–∞—Å–∫–∏ –¥–æ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(np.uint8(image_mask * 255), cv2.COLOR_GRAY2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_15_0.png)
‚Äã    



```python
# –°–ª–∞–±–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ (–∑–∞–º—ã–∫–∞–Ω–∏–µ): (ùê¥ ‚äï ùêµ) ‚äñ ùêµ
selem = skimage.morphology.disk(3)
image_mask = skimage.morphology.dilation(image_mask, selem)
image_mask = skimage.morphology.erosion(image_mask, selem)

expanded = image_mask.copy()

# –ú–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–µ —Å–∂–∞—Ç–∏–µ
selem = skimage.morphology.disk(5)
for i in range(7):
    expanded = skimage.morphology.erosion(expanded, selem)

# –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–æ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤, —á—Ç–æ–±—ã –∫—Ä–∞—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –ø–æ—Ä—Ç–∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
if use_graph:
    size=np.array(expanded.shape)
    expanded_huge = np.zeros(shape=size * 3, dtype=np.bool)
    expanded_huge[size[0]:2*size[0], size[1]:2*size[1]] = expanded
    expanded = expanded_huge
    expanded_huge = np.logical_not(expanded_huge)
    expanded_huge = skimage.morphology.thin(expanded_huge)
    expanded_huge = np.logical_not(expanded_huge)
    expanded = expanded_huge[size[0]:2*size[0], size[1]:2*size[1]]
    image_mask = np.logical_and(image_mask, expanded)

# –°–ª–∞–±–∞—è —ç—Ä–æ–∑–∏—è: ùê¥ ‚äñ ùêµ
selem = skimage.morphology.disk(3)
image_mask = skimage.morphology.erosion(image_mask, selem)
```


```python
# –í–∏–¥ –º–∞—Å–∫–∏ –ø–æ—Å–ª–µ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(np.uint8(image_mask * 255), cv2.COLOR_GRAY2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_17_0.png)
‚Äã    



```python
# –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –≤—ã–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ç—É—Ä–æ–≤
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    thresh = cv2.threshold(np.uint8(image_mask * 255), 0, 255, cv2.THRESH_BINARY | cv2.THRESH_OTSU)
    print(thresh[1])
    cnts = cv2.findContours(thresh[1], cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)
    cnts = imutils.grab_contours(cnts)
    image_to_show = cv2.cvtColor(image, cv2.COLOR_HSV2BGR)
    for (i, c) in enumerate(cnts):
        # draw the contour
        ((x, y), _) = cv2.minEnclosingCircle(c)
        cv2.putText(image_to_show, "#{}".format(i + 1), (int(x) - 10, int(y)),
            cv2.FONT_HERSHEY_SIMPLEX, 0.9, (0, 0, 255), 2)
        cv2.drawContours(image_to_show, [c], -1, (0, 255, 0), 2)
    plt.imshow(cv2.cvtColor(image_to_show, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```

    Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).


    [[0 0 0 ... 0 0 0]
     [0 0 0 ... 0 0 0]
     [0 0 0 ... 0 0 0]
     ...
     [0 0 0 ... 0 0 0]
     [0 0 0 ... 0 0 0]
     [0 0 0 ... 0 0 0]]




![png](output_18_2.png)
    


–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ–ª—É—á–∏–ª—Å—è –Ω–∞ —É–¥–∏–≤–ª–µ–Ω–∏–µ —Ö–æ—Ä–æ—à–∏–º, —Ö–æ—Ç—è –∏ –Ω–∞ –º–µ—Å—Ç–µ —Å—Ç—ã–∫–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ—Ä–æ–≤–Ω–æ—Å—Ç–∏.

–ì–ª–∞–≤–Ω—ã–º –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–º —Ç–∞–∫–æ–≥–æ –º–µ—Ç–æ–¥–∞ —è–≤–ª—è–µ—Ç—Å—è —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã, —Ç–∞–∫ –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—è skimage.morphology.thin 
–º–∞–ª–æ —Ç–æ–≥–æ —á—Ç–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –≤—ã–∑—ã–≤–∞—Ç—å —Å–µ–±—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ—Ç–µ–Ω —Ä–∞–∑, —Ç–∞–∫ –∏ –µ—â—ë –∏ –≤ skimage –Ω–µ—Ç –Ω—É–∂–Ω–æ–π
—Ñ—É–Ω–∫—Ü–∏–∏, –∏ –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏—à–ª–æ—Å—å —Ä–∞—Å—à–∏—Ä—è—Ç—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –≤ 9 —Ä–∞–∑, —á—Ç–æ–±—ã –∫—Ä–∞—è –Ω–µ –≤–Ω–æ—Å–∏–ª–∏ —Å–≤–æ–π –≤–∫–ª–∞–¥. 
–≠—Ç–æ–≥–æ –º–æ–∂–Ω–æ –±—ã–ª–æ –∏–∑–±–µ–∂–∞—Ç—å, –µ—Å–ª–∏ –≤—Ä—É—á–Ω—É—é –ø–æ–º–µ–Ω—è—Ç—å –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏ skimage.morphology.thin 
–∏–ª–∏ –Ω–∞–ø–∏—Å–∞—Ç—å –Ω—É–∂–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é —Å –Ω—É–ª—è.

### –õ–∏—Å—Ç–∏–Ω–≥ 3. –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ –≤–æ–¥–æ—Ä–∞–∑–¥–µ–ª–∞–º

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –µ—â–µ –æ–¥–∏–Ω –∏–∑ –ø—Ä–∏–º–µ—Ä–æ–≤ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π
–º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏ –∫ –∑–∞–¥–∞—á–µ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è. –í –ø–æ–¥—Ö–æ–¥–µ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ –≤–æ–¥–æ—Ä–∞–∑–¥–µ–ª–∞–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è 
–∫–∞–∫ –∫–∞—Ä—Ç–∞ –≤—ã—Å–æ—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏ –ø–∏–∫—Å–µ–ª–µ–π –æ–ø–∏—Å—ã–≤–∞—é—Ç –≤—ã—Å–æ—Ç—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–µ–∫–æ—Ç–æ—Ä–æ–≥–æ —É—Ä–æ–≤–Ω—è. 
–ù–∞ —Ç–∞–∫—É—é ¬´–≤—ã—Å–æ—Ç–Ω—É—é –º–µ—Å—Ç–Ω–æ—Å—Ç—å¬ª ¬´–ª—å–µ—Ç
–¥–æ–∂–¥—å¬ª, –æ–±—Ä–∞–∑—É—è –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤–æ–¥–æ—Å–±–æ—Ä–Ω—ã—Ö –±–∞—Å—Å–µ–π–Ω–æ–≤. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –≤–æ–¥–∞ –∏–∑ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –±–∞—Å—Å–µ–π–Ω–æ–≤ –ø–µ—Ä–µ–ª–∏–≤–∞–µ—Ç—Å—è, 
–∏ –±–∞—Å—Å–µ–π–Ω—ã –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ –±–æ–ª–µ–µ –∫—Ä—É–ø–Ω—ã–µ. –ú–µ—Å—Ç–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –±–∞—Å—Å–µ–π–Ω–æ–≤
–æ—Ç–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ –ª–∏–Ω–∏–∏ –≤–æ–¥–æ—Ä–∞–∑–¥–µ–ª–∞. –ï—Å–ª–∏ ¬´–¥–æ–∂–¥—å¬ª –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞–Ω–æ, —Ç–æ–≥–¥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ 
–Ω–∞ –º–µ–ª–∫–∏–µ –æ–±–ª–∞—Å—Ç–∏, –∞
–µ—Å–ª–∏ –ø–æ–∑–¥–Ω–æ ‚Äî –Ω–∞ –∫—Ä—É–ø–Ω—ã–µ. –í —Ç–∞–∫–æ–º –ø–æ–¥—Ö–æ–¥–µ –≤—Å–µ –ø–∏–∫—Å–µ–ª–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è –Ω–∞ —Ç—Ä–∏ —Ç–∏–ø–∞:

1. –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–∏–Ω–∏–º—É–º—ã;

2. –Ω–∞—Ö–æ–¥—è—â–∏–µ—Å—è –Ω–∞ —Å–∫–ª–æ–Ω–µ (—Å –∫–æ—Ç–æ—Ä—ã—Ö –≤–æ–¥–∞ —Å–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –æ–¥–∏–Ω –∏
—Ç–æ—Ç –∂–µ –ª–æ–∫–∞–ª—å–Ω—ã–π –º–∏–Ω–∏–º—É–º);

3. –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–∞–∫—Å–∏–º—É–º—ã (—Å –∫–æ—Ç–æ—Ä—ã—Ö –≤–æ–¥–∞ —Å–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è –±–æ–ª–µ–µ —á–µ–º
–≤ –æ–¥–∏–Ω –º–∏–Ω–∏–º—É–º).

–ü—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–æ–¥–æ—Å–±–æ—Ä–Ω—ã–µ –±–∞—Å—Å–µ–Ω—ã –∏ –ª–∏–Ω–∏–∏ –≤–æ–¥–æ—Ä–∞–∑–¥–µ–ª–∞ –ø—É—Ç–µ–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö
–æ–±–ª–∞—Å—Ç–µ–π –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫. –ê–ª–≥–æ—Ä–∏—Ç–º —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤:

1. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏. –ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –¥–ª—è —ç—Ç–æ–≥–æ
–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

2. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤ –ø–µ—Ä–µ–¥–Ω–µ–≥–æ –ø–ª–∞–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —Å–≤—è–∑–Ω–æ—Å—Ç–∏ –ø–∏–∫—Å–µ–ª–µ–π –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞.

3. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤ —Ñ–æ–Ω–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏—Ö –ø–∏–∫—Å–µ–ª–∏, –Ω–µ —è–≤–ª—è—é—â–∏–µ—Å—è –æ–±—ä–µ–∫—Ç–∞–º–∏.

4. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å —É—á–µ—Ç–æ–º –≤–∑–∞–∏–º–æ—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤ –ø–µ—Ä–µ–¥–Ω–µ–≥–æ –ø–ª–∞–Ω–∞ –∏ —Ñ–æ–Ω–∞.

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Ä–∞–±–æ—Ç—ã –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –±—É–¥–µ—Ç –ø–æ–ª—É—á–µ–Ω–∞ –º–∞—Å–∫–∞, –≥–¥–µ –ø–∏–∫—Å–µ–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –±—É–¥—É—Ç –ø–æ–º–µ—á–µ–Ω—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –º–µ—Ç–∫–∞–º–∏
–∏ –±—É–¥—É—Ç –æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å —Å–≤—è–∑–Ω—É—é –æ–±–ª–∞—Å—Ç—å.


```python
# –ò—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
image = cv2.imread("data/coins_2.jpg")
```

–ü–æ–ø—Ä–æ–±—É—é —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥–æ–º –≤–æ–¥–æ—Ä–∞–∑–¥–µ–ª–∞ –º–æ–Ω–µ—Ç—ã.


```python
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_22_0.png)
‚Äã    



```python
# –ü–µ—Ä–µ–≤–æ–¥ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ HSV
image = cv2.cvtColor(np.float32(image / 255.0), cv2.COLOR_BGR2HSV)

# –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å–∫–∏ –¥–ª—è —Ü–≤–µ—Ç–∞ —è–±–ª–æ–∫
image_mask = image[:,:,2] < 0.6

# –û—Ç–∫—Ä—ã—Ç–∏–µ (–æ—Ç–º—ã–∫–∞–Ω–∏–µ, —Ä–∞–∑–º—ã–∫–∞–Ω–∏–µ, —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ): (ùê¥ ‚äñ ùêµ) ‚äï ùêµ
selem = skimage.morphology.disk(11)
image_mask = skimage.morphology.erosion(image_mask, selem)
image_mask = skimage.morphology.dilation(image_mask, selem)
```


```python
# –í–∏–¥ –º–∞—Å–∫–∏ –ø–æ—Å–ª–µ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –Ω–æ –¥–æ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤–æ–¥–æ—Ä–∞–∑–¥–µ–ª–æ–º
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(np.uint8(image_mask * 255), cv2.COLOR_GRAY2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_24_0.png)
‚Äã    



```python
# –°–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ª—å–µ—Ñ–∞
D = scipy.ndimage.distance_transform_edt(image_mask * 1)
```


```python
# *–ì–ª—É–±–∏–Ω–∞* –≤–ø–∞–¥–∏–Ω—ã, –∫—É–¥–∞ –±—É–¥–µ—Ç —Å—Ç–µ–∫–∞—Ç—å –≤–æ–¥–∞
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    D_heat = np.float32(D / np.max(D))
    heat = cv2.applyColorMap(np.uint8(D_heat * 255), cv2.COLORMAP_JET)
    plt.imshow(cv2.cvtColor(heat, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_26_0.png)
‚Äã    



```python
# –í—ã–±–æ—Ä –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–∏–Ω–∏–º—É–º–æ–≤ —Ä–µ–ª—å–µ—Ñ–∞
localMax = skimage.feature.peak_local_max(D, indices=False, min_distance=15, labels=image_mask)
markers = scipy.ndimage.label(localMax, structure=np.ones((3, 3)))[0]
```


```python
# –õ–æ–∫–∞–ª—å–Ω—ã–µ –º–∏–Ω–∏–º—É–º—ã —Ä–µ–ª—å–µ—Ñ–∞ –≤ –≤–∏–¥–µ —Ç–æ—á–µ–∫
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    image_to_show = markers
    selem = skimage.morphology.disk(7)
    image_to_show = skimage.morphology.dilation(image_to_show, selem)
    image_to_show = cv2.cvtColor(np.uint8(image_to_show * 255), cv2.COLOR_GRAY2RGB)
    plt.imshow(image_to_show)
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_28_0.png)
‚Äã    



```python
# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤–æ–¥–æ—Ä–∞–∑–¥–µ–ª–æ–º
labels = skimage.segmentation.watershed(-D, markers, mask=image_mask)

```


```python
# –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤–æ–¥–æ—Ä–∞–∑–¥–µ–ª–æ–º
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    labels_colored = np.zeros_like(labels, dtype=np.uint8)
    labels_colored = cv2.cvtColor(labels_colored, cv2.COLOR_GRAY2RGB)
    for label in np.unique(labels):
        if label == 0:
            continue
        labels_colored[labels == label] = np.uint8(np.round((np.random.rand(3) * 255)))
    plt.imshow(labels_colored)
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_30_0.png)
‚Äã    



```python
# –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤–æ–¥–æ—Ä–∞–∑–¥–µ–ª–æ–º –∏ –≤—ã–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ç—É—Ä–æ–≤
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    image_to_show = cv2.cvtColor(image, cv2.COLOR_HSV2BGR)
    label_count = 0
    for label in np.unique(labels):
        if label == 0:
            continue
        mask = np.zeros(image_mask.shape, dtype="uint8")
        mask[labels == label] = 255
        cnts = cv2.findContours(mask.copy(), cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)
        cnts = imutils.grab_contours(cnts)
        c = max(cnts, key=cv2.contourArea)
        ((x, y), r) = cv2.minEnclosingCircle(c)
        cv2.circle(image_to_show, (int(x), int(y)), int(r), (0, 255, 0), 2)
        cv2.putText(image_to_show, "#{}".format(label), (int(x) - 10, int(y)),
            cv2.FONT_HERSHEY_SIMPLEX, 0.6, (0, 0, 255), 2)
        label_count = label
    plt.imshow(cv2.cvtColor(image_to_show, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
    print(f"label_count = {label_count}")
```

    Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).




![png](output_31_1.png)
    


    label_count = 79

