```python
import cv2
import skimage.filters
import skimage.exposure
import skimage.morphology
import numpy as np
from matplotlib import pyplot as plt
from matplotlib.pyplot import figure
import warnings
warnings.filterwarnings('ignore')
export_parallel = True
use_graph = True
```

### –õ–∏—Å—Ç–∏–Ω–≥ 1. –ë–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è


```python
# –ò—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
image = cv2.cvtColor(cv2.imread("data/sudoku.jpg"), cv2.COLOR_BGR2GRAY)
print(image.shape)
```

    (1024, 768)



```python
# –ò—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image, cv2.COLOR_GRAY2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_3_0.png)
‚Äã    


### –õ–∏—Å—Ç–∏–Ω–≥ 1.1. –ë–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è –ø–æ –æ–¥–∏–Ω–∞—Ä–Ω–æ–º—É –ø–æ—Ä–æ–≥—É.

–ü—Ä–æ—Å—Ç–µ–π—à–∏–º —Å–ø–æ—Å–æ–±–æ–º —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –¥–≤–∞ –∫–ª–∞—Å—Å–∞
(—Ñ–æ–Ω–æ–≤—ã–µ –ø–∏–∫—Å–µ–ª–∏ –∏ –ø–∏–∫—Å–µ–ª–∏ –æ–±—ä–µ–∫—Ç–∞) —è–≤–ª—è–µ—Ç—Å—è –±–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è. 
–ë–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—é –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ –ø–æ—Ä–æ–≥—É –∏–ª–∏ –ø–æ –¥–≤–æ–π–Ω–æ–º—É –ø–æ—Ä–æ–≥—É. 

–í –ø–µ—Ä–≤–æ–º —Å–ª—É—á–∞–µ:

ùêºùëõùëíùë§(ùë•,ùë¶) = {0, ùêº(ùë•,ùë¶) <= t; 1, ùêº(ùë•,ùë¶) > t}


```python
t = 64
ret, image_bin = cv2.threshold(image, t, 255, cv2.THRESH_BINARY)

# –ë–∏–Ω–∞—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image_bin, cv2.COLOR_GRAY2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_5_0.png)
‚Äã    


### –õ–∏—Å—Ç–∏–Ω–≥ 1.2. –ë–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è –ø–æ –¥–≤–æ–π–Ω–æ–º—É –ø–æ—Ä–æ–≥—É.

–ë–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è –ø–æ –¥–≤–æ–π–Ω–æ–º—É –ø–æ—Ä–æ–≥—É (–¥–∏–∞–ø–∞–∑–æ–Ω–Ω–∞—è –±–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è):

ùêºùëõùëíùë§(ùë•,ùë¶) ={0, ùêº(ùë•,ùë¶) <= ùë°1; 1, ùë°1 < ùêº(ùë•,ùë¶) <= ùë°2; 0, ùêº(ùë•,ùë¶) > ùë°2}

–≥–¥–µ ùêº ‚Äî –∏—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, 
ùêºùëõùëíùë§ ‚Äî –±–∏–Ω–∞—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, 
ùë°1 –∏ ùë°2 ‚Äî –≤–µ—Ä—Ö–Ω–∏–π –∏ –Ω–∏–∂–Ω–∏–π –ø–æ—Ä–æ–≥–∏ –±–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏–∏.


```python
t1 = 50
t2 = 127

image_bin = cv2.inRange(image, t1, t2)

# –ë–∏–Ω–∞—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image_bin, cv2.COLOR_GRAY2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_7_0.png)
‚Äã    


### –õ–∏—Å—Ç–∏–Ω–≥ 1.3. –ë–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–º –û—Ç—Å—É.

–ü–æ—Ä–æ–≥–∏ –±–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏–∏ ùë°, ùë°1 –∏ ùë°2 –º–æ–≥—É—Ç –±—ã—Ç—å –ª–∏–±–æ –∑–∞–¥–∞–Ω—ã –≤—Ä—É—á–Ω—É—é,
–ª–∏–±–æ –≤—ã—á–∏—Å–ª–µ–Ω—ã —Å –ø–æ–º–æ—â—å—é —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤. 
–í —Å–ª—É—á–∞–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø–æ—Ä–æ–≥–∞ –º–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º –û—Ç—Å—É


```python
image_blur = cv2.GaussianBlur(image,(5,5),0)
ret3, image_bin = cv2.threshold(image_blur, 255, 255, cv2.THRESH_BINARY + cv2.THRESH_OTSU)

# –ë–∏–Ω–∞—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image_bin, cv2.COLOR_GRAY2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_9_0.png)
‚Äã    


### –õ–∏—Å—Ç–∏–Ω–≥ 1.4. –ë–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–º –û—Ç—Å—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã.

–õ–∏–±–æ –º—ã –º–æ–∂–µ–º —Å–∞–º–∏ –Ω–∞–π—Ç–∏ –ø–æ—Ä–æ–≥ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:


```python
t_otsu = skimage.filters.threshold_otsu(image)
hist, bins_center = skimage.exposure.histogram(image)
print(t_otsu)
ret, image_bin = cv2.threshold(image, t_otsu, 255, cv2.THRESH_BINARY)

# –ë–∏–Ω–∞—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø–æ—Ä–æ–≥–æ–º –û—Ç—Å—É
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image_bin, cv2.COLOR_GRAY2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
    figure(figsize=(9, 4), dpi=80)
    plt.plot(bins_center, hist, lw=2)
    plt.axvline(t_otsu, color='k', ls='--')
    plt.tight_layout()
    plt.show()
```

    77




![png](output_11_1.png)
    




![png](output_11_2.png)
    


### –õ–∏—Å—Ç–∏–Ω–≥ 1.5. –ë–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º –º–µ—Ç–æ–¥–æ–º.

–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –Ω–µ —Å–æ –≤—Å–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º,
–∞ –ª–∏—à—å —Å –µ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞–º–∏. –¢–∞–∫–∏–µ –ø–æ–¥—Ö–æ–¥—ã –∑–∞—á–∞—Å—Ç—É—é –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
–ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –Ω–µ–æ–¥–Ω–æ—Ä–æ–¥–Ω–æ –æ—Å–≤–µ—â–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã. 

–í –æ–¥–Ω–æ–º —Ç–æ–ª—å–∫–æ OpenCV –æ–∫–æ–ª–æ –¥–µ—Å—è—Ç–∫–∞ –º–µ—Ç–æ–¥–æ–≤ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π –±–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏–∏, 
–Ω–æ –≤–æ—Ç 2 —Å–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ: Gaussian –∏ Mean


```python
image_blur = cv2.medianBlur(image, 5)
image_bin_gaussian = cv2.adaptiveThreshold(image_blur,255,cv2.ADAPTIVE_THRESH_GAUSSIAN_C, cv2.THRESH_BINARY, 21, 5)
image_bin_mean = cv2.adaptiveThreshold(image_blur,255,cv2.ADAPTIVE_THRESH_MEAN_C, cv2.THRESH_BINARY, 21, 5)

# –ë–∏–Ω–∞—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º –º–µ—Ç–æ–¥–æ–º –ì–∞—É—Å—Å–∞ –∏ –ú–µ–¥–∏–∞–Ω–Ω—ã–º
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image_bin_gaussian, cv2.COLOR_GRAY2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image_bin_mean, cv2.COLOR_GRAY2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_13_0.png)
‚Äã    




![png](output_13_1.png)
    


### –õ–∏—Å—Ç–∏–Ω–≥ 2. –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

### –õ–∏—Å—Ç–∏–Ω–≥ 2.1 –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è RGB-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ —Ü–≤–µ—Ç—É –∫–æ–∂–∏

–û–±—â–∏–º –ø—Ä–∏–Ω–∏—Ü–ø–æ–º –¥–∞–Ω–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ —è–≤–ª—è–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è –±–ª–∏–∑–æ—Å—Ç–∏ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏ –ø–∏–∫—Å–µ–ª–µ–π –∫ –æ—Ç—Ç–µ–Ω–∫—É –∫–æ–∂–∏. 
–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏ –æ–ø–∏—Å–∞—Ç—å –æ—Ç—Ç–µ–Ω–æ–∫ –∫–æ–∂–∏ –¥–æ–≤–æ–ª—å–Ω–æ –∑–∞—Ç—Ä—É–¥–Ω–∏—Ç–µ–ª—å–Ω–æ, –ø–æ—Å–∫–æ–ª—å–∫—É –µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏–µ –±–∞–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–º 
–≤–æ—Å–ø—Ä–∏—è—Ç–∏–∏ —Ü–≤–µ—Ç–∞, –º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ—Å–≤–µ—â–µ–Ω–∏—è, –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è —É —Ä–∞–∑–Ω—ã—Ö –Ω–∞—Ä–æ–¥–Ω–æ—Å—Ç–µ–π, –∏ —Ç.–¥.

–°—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–∏—Å–∞–Ω–∏–π –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ —Ü–≤–µ—Ç–æ–≤–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ RGB, –ø–æ–∑–≤–æ–ª—è—é—â–∏—Ö –æ—Ç–Ω–µ—Å—Ç–∏ –ø–∏–∫—Å–µ–ª—å
–∫ –∫–ª–∞—Å—Å—É ¬´–∫–æ–∂–∞¬ª –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —É—Å–ª–æ–≤–∏–π:

{
ùëÖ > 95,
ùê∫ > 40,
ùêµ < 20,
max(ùëÖ,ùê∫,ùêµ) ‚àí min(ùëÖ,ùê∫,ùêµ) > 15,
|ùëÖ ‚àí ùê∫| > 15,
ùëÖ > ùê∫,
ùëÖ > ùêµ,
}

–∏–ª–∏

{
ùëÖ > 220,
ùê∫ > 210,
ùêµ > 170,
|ùëÖ ‚àí ùê∫| <= 15,
ùê∫ > ùêµ,
ùëÖ > ùêµ,
}

–∏–ª–∏

{
ùëü = ùëÖ / (ùëÖ+ùê∫+ùêµ),
g = G / (ùëÖ+ùê∫+ùêµ),
b = B / (ùëÖ+ùê∫+ùêµ),
ùëü / ùëî > 1.185,
(ùëüb)/((ùëü+ùëî+ùëè)^2) > 0.107,
(ùëüg)/((ùëü+ùëî+ùëè)^2) > 0.112,
}

–ò–∑ –≤—Å–µ—Ö —Å–æ–ª–∏–¥–Ω–µ–µ –≤—Å–µ–≥–æ –≤—ã–≥–ª—è–¥–∏—Ç 3 –º–µ—Ç–æ–¥, –Ω–æ –≤–æ–∑—å–º—É —Ö–æ—Ç—è –±—ã –∫–∞–∫-—Ç–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–π 2, 
–∏ –Ω–µ —Å—Ç–æ–∏—Ç —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏ –Ω–µ —Ä–∞—Å–∏—Å—Ç—Å–∫–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ª–∏—Ü 
–∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ü–≤–µ—Ç–æ–≤–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏.

–≠—Ç–æ–º—É –∞–ª–≥–æ—Ä–∏—Ç–º—É –∑–∞—Ä–∞–Ω–µ–µ –æ—á–µ–Ω—å –∂–∞–ª—å –∑–∞ —Å–≤–æ–π —Ä–∞—Å–∏–∑–º, –æ–Ω –Ω–µ —Ö–æ—Ç–µ–ª, –ø—Ä–∞–≤–¥–∞... –•–æ—Ç—è –∏ –∂–µ–∞–Ω–∏–π —Ç–æ —É –∫—É—á–∫–∏ —Ñ–æ—Ä–º—É–ª –Ω–µ—Ç


```python
# –ò—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –ª–∏—Ü–∞–º–∏.
image = cv2.cvtColor(cv2.imread("data/face.jpg"), cv2.COLOR_BGR2RGB)
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(image)
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_16_0.png)
‚Äã    



```python
r, g, b = cv2.split(image)
conditions = []

"""
ùëÖ > 220,
ùê∫ > 210,
ùêµ > 170,
|ùëÖ ‚àí ùê∫| <= 32,
ùê∫ > ùêµ,
ùëÖ > ùêµ,
"""
if use_graph:
    conditions.append(r > 220)
    conditions.append(g > 210)
    conditions.append(b > 170)
    conditions.append(np.abs(r - g) <= 32) # –†–∞—Å—à–∏—Ä–∏–ª 15 –¥–æ 32
    conditions.append(g > b)
    conditions.append(r > b)
    faces_mask = conditions[0]
    for condition in conditions:
        faces_mask = np.bitwise_and(faces_mask, condition)
```


```python
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(np.uint8(faces_mask * 255), cv2.COLOR_GRAY2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_18_0.png)
‚Äã    


–ü–æ–ª—É—á–µ–Ω–Ω–∞—è –º–∞—Å–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –ª–∏—Ü–∞... –í –∫–∞–∫–∏—Ö-—Ç–æ –º–µ—Å—Ç–∞—Ö, 
–Ω–æ –∫–∞—á–µ—Å—Ç–≤–æ —Ç–∞–∫–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏, –∫–∞–∫ –∏ –æ–∂–∏–¥–∞–ª–æ—Å—å, —Å—Ç—Ä–∞–¥–∞–µ—Ç.

### –õ–∏—Å—Ç–∏–Ω–≥ 2.2. –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ü–≤–µ—Ç–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ Lab.

–í —Ü–≤–µ—Ç–æ–≤–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ Lab –∑–Ω–∞—á–µ–Ω–∏–µ —Å–≤–µ—Ç–ª–æ—Ç—ã –æ—Ç–¥–µ–ª–µ–Ω–æ –æ—Ç
–∑–Ω–∞—á–µ–Ω–∏—è —Ö—Ä–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–æ—Å—Ç–∞–≤–ª—è—é—â–µ–π —Ü–≤–µ—Ç–∞ (—Ç–æ–Ω, –Ω–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç—å).
–°–≤–µ—Ç–ª–æ—Ç–∞ –∑–∞–¥–∞–µ—Ç—Å—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ–π L, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç 0 (—Ç–µ–º–Ω—ã–π) –¥–æ 100 (—Å–≤–µ—Ç–ª—ã–π). 
–•—Ä–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∞—è —Ü–≤–µ—Ç–∞ –∑–∞–¥–∞–µ—Ç—Å—è –¥–≤—É–º—è –¥–µ–∫–∞—Ä—Ç–æ–≤—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ a (–æ–∑–Ω–∞—á–∞–µ—Ç
–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç –∑–µ–ª–µ–Ω–æ–≥–æ (‚àí128) –¥–æ –∫—Ä–∞—Å–Ω–æ–≥–æ (127))
–∏ b (–æ–∑–Ω–∞—á–∞–µ—Ç –ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç —Å–∏–Ω–µ–≥–æ (‚àí128) –¥–æ
–∂–µ–ª—Ç–æ–≥–æ (127)). –ë–∏–Ω–∞—Ä–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω—É–ª–µ–≤—ã—Ö
–∑–Ω–∞—á–µ–Ω–∏—è—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç a –∏ b. 

–ò–¥–µ—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ä–∞–∑–±–∏–µ–Ω–∏–∏
—Ü–≤–µ—Ç–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç—ã –¥–æ–º–∏–Ω–∏—Ä—É—é—â–∏—Ö —Ü–≤–µ—Ç–æ–≤.

–í –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å, —á—Ç–æ–±—ã —É–º–µ–Ω—å—à–∏—Ç—å –≤–ª–∏—è–Ω–∏–µ –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–∞
—Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –ø–æ–ª–Ω–æ—Ü–≤–µ—Ç–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑
—Ü–≤–µ—Ç–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ RGB –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ Lab.


```python
NUM_CLASSES = 5

image = cv2.cvtColor(np.float32(cv2.imread("data/segmentation/apples.jpg")) / 255.0, cv2.COLOR_BGR2Lab)
classes = [cv2.cvtColor(np.float32(cv2.imread(f"data/segmentation/class{i}.jpg")  / 255.0), cv2.COLOR_BGR2Lab) \
           for i in range(1, NUM_CLASSES + 1)]
```


```python
# –ù–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ —Å–∞–º–∏ —Å–µ–≥–º–µ–Ω—Ç–∏—Ä—É–µ–º—ã–µ –∫–ª–∞—Å—Å—ã
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image, cv2.COLOR_Lab2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
    figure(figsize=(32, 16), dpi=80)
    classes_all = cv2.resize(classes[0], (128, 128))
    for i in range(1, NUM_CLASSES):
        classes_all = cv2.hconcat([classes_all, cv2.resize(classes[i], (128, 128))])
    plt.imshow(cv2.cvtColor(classes_all, cv2.COLOR_Lab2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_22_0.png)
‚Äã    




![png](output_22_1.png)
    


–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ü–≤–µ—Ç–æ–≤—ã–µ –º–µ—Ç–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ
–∏–∑ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –ø—É—Ç–µ–º —Ä–∞—Å—á–µ—Ç–∞ —Å—Ä–µ–¥–Ω–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Ü–≤–µ—Ç–Ω–æ—Å—Ç–∏ –≤ –∫–∞–∂–¥–æ–π –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏. 


```python
for i in range(NUM_CLASSES):
    classes[i] = cv2.mean(classes[i])[:3]
print("–°—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ü–≤–µ—Ç–∞ –¥–ª—è –∫–ª–∞—Å—Å–æ–≤ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ LAB:\n", *classes, sep='\n')
```

    –°—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ü–≤–µ—Ç–∞ –¥–ª—è –∫–ª–∞—Å—Å–æ–≤ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ LAB:
    
    (80.34150159593467, -13.025004984051037, 51.59429990696438)
    (78.34551098005278, 5.3434655179008566, 47.33589207848837)
    (36.16674919549247, 44.693474712037634, 15.289422452952627)
    (62.664387774077085, 5.018075980392156, 20.38099795330503)
    (30.270070969683566, 23.056795400943397, 32.33057193396226)


–ó–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–Ω—Ü–∏–ø –±–ª–∏–∂–∞–π—à–µ–π –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–∏–∫—Å–µ–ª–µ–π –ø—É—Ç–µ–º –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –µ–≤–∫–ª–∏–¥–æ–≤—ã—Ö 
–º–µ—Ç—Ä–∏–∫ –º–µ–∂–¥—É –ø–∏–∫—Å–µ–ª—è–º–∏ –∏ –º–µ—Ç–∫–∞–º–∏: —á–µ–º –º–µ–Ω—å—à–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –º–µ—Ç–∫–∏, —Ç–µ–º
–ª—É—á—à–µ –ø–∏–∫—Å–µ–ª—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–∞–Ω–Ω–æ–º—É —Å–µ–≥–º–µ–Ω—Ç—É. 


```python
image_classes = [image.copy() * 1.0 for i in range(NUM_CLASSES)]
for i in range(NUM_CLASSES):
    image_classes[i] = np.sqrt(np.sum((image_classes[i] - classes[i]) ** 2, axis=2))
image_classes_min = image_classes[0]
for i in range(1, NUM_CLASSES):
    image_classes_min = np.minimum(image_classes_min, image_classes[i])
for i in range(NUM_CLASSES):
    image_classes[i] = (np.equal(image_classes[i], image_classes_min) * 255).astype(dtype=np.uint8)
```


```python
image_bgr = cv2.cvtColor(image, cv2.COLOR_Lab2BGR)
# –ú–∞—Å–∫–∏ 5 –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    classes_all = cv2.bitwise_and(image_bgr, image_bgr, mask=image_classes[0])
    for i in range(1, NUM_CLASSES):
        new_image = cv2.bitwise_and(image_bgr, image_bgr, mask=image_classes[i])
        classes_all = cv2.hconcat([classes_all, new_image])
    plt.imshow(cv2.cvtColor(classes_all, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_27_0.png)
‚Äã    


–ó–∞–∫—Ä–∞—à—É –∏—Å—Ö–æ–¥–Ω—ã–µ –∫–ª–∞—Å—Å—ã –Ω–∞ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —Ü–≤–µ—Ç–æ–º —Å–≤–æ–µ–≥–æ —Å—Ä–µ–¥–Ω–µ–≥–æ.


```python
image_bgr_zero = cv2.cvtColor(image, cv2.COLOR_Lab2BGR) * 0.0
classes_all = None
# –ú–∞—Å–∫–∏ 5 –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤
for i in range(NUM_CLASSES):
    color_new = cv2.cvtColor( np.float32([[classes[i]]] ), cv2.COLOR_Lab2BGR)[0][0]
    classes_new = cv2.bitwise_and(image_bgr_zero + color_new, image_bgr_zero + color_new, mask=image_classes[i])
    if classes_all is None:
        classes_all = classes_new
    else:
        classes_all += classes_new
```


```python
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(classes_all, cv2.COLOR_BGR2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_30_0.png)
‚Äã    


### –õ–∏—Å—Ç–∏–Ω–≥ 2.3. –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –º–µ—Ç–æ–¥–æ–º ùëò-—Å—Ä–µ–¥–Ω–∏—Ö.

–ò–¥–µ—è –º–µ—Ç–æ–¥–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ —Ü–µ–Ω—Ç—Ä–æ–≤ ùëò-–∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –∏
–æ—Ç–Ω–µ—Å–µ–Ω–∏–∏ –∫ –∫–∞–∂–¥–æ–º—É –∫–ª–∞—Å—Ç–µ—Ä—É –ø–∏–∫—Å–µ–ª–µ–π, –Ω–∞–∏–±–æ–ª–µ–µ –±–ª–∏–∑–∫–æ –æ—Ç–Ω–æ—Å—è—â–∏—Ö—Å—è –∫ —ç—Ç–∏–º —Ü–µ–Ω—Ç—Ä–∞–º. 
–í—Å–µ –ø–∏–∫—Å–µ–ª–∏ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –∫–∞–∫ –≤–µ–∫—Ç–æ—Ä—ã
ùë•ùëñ, (ùëñ = 1:ùëù). –ê–ª–≥–æ—Ä–∏—Ç–º —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤:

1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º ùëò –≤–µ–∫—Ç–æ—Ä–æ–≤ ùëöùëó, (ùëó = 1:ùëò), –∫–æ—Ç–æ—Ä—ã–µ –æ–±—ä—è–≤–ª—è—é—Ç—Å—è –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ —Ü–µ–Ω—Ç—Ä–∞–º–∏ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤.
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π —Å—Ä–µ–¥–Ω–∏—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤ ùëöùëó –ø—É—Ç–µ–º –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π –æ—Ç –∫–∞–∂–¥–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–∞ ùë•ùëñ –¥–æ –∫–∞–∂–¥–æ–≥–æ ùëöùëó –∏ –∏—Ö –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—é –º–∏–Ω–∏–º–∞–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –æ—Ç –≤–µ–∫—Ç–æ—Ä–∞
–¥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞, –ø–µ—Ä–µ—Å—á–µ—Ç —Å—Ä–µ–¥–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π ùëöùëó –ø–æ –≤—Å–µ–º –∫–ª–∞—Å—Ç–µ—Ä–∞–º.
3. –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ —à–∞–≥–æ–≤ 2 –∏ 3 –¥–æ —Ç–µ—Ö –ø–æ—Ä–∞, –ø–æ–∫–∞ —Ü–µ–Ω—Ç—Ä—ã –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
–Ω–µ –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è.

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞ –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–∞ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø–æ–¥—Ö–æ–¥ –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä—è–¥ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π. 
–ë—É–¥–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ü–≤–µ—Ç–æ–≤–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ Lab, –ø–æ—ç—Ç–æ–º—É –ø–µ—Ä–≤—ã–º —à–∞–≥–æ–º –ø–µ—Ä–µ–π–¥–µ–º –∏–∑ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ RGB –≤ Lab:


```python
if use_graph:
    pixel_values = np.float32(image.reshape((-1, 3)))
    print(pixel_values.shape)
    
    # –ö—Ä–∏—Ç–µ—Ä–∏–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ü–∏–∫–ª–∞ 2-3:
    # –ú—ã –æ—Å—Ç–∞–Ω–æ–≤–∏–º—Å—è –ª–∏–±–æ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –Ω–µ–∫–æ—Ç–æ—Ä–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏—Ç–µ—Ä–∞—Ü–∏–π
    # –õ–∏–±–æ –µ—Å–ª–∏ –∫–ª–∞—Å—Ç–µ—Ä—ã –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è –º–µ–Ω—å—à–µ, —á–µ–º –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ epsilon
    
    criteria = (cv2.TERM_CRITERIA_EPS + cv2.TERM_CRITERIA_MAX_ITER, 200, 0.01)
    
    k = 5 # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Å–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞
    _, labels, (centers) = cv2.kmeans(pixel_values, k, None, criteria, 20, cv2.KMEANS_RANDOM_CENTERS)
    centers = np.float32(centers)
    labels = labels.flatten()
    segmented_image = centers[labels.flatten()]
    segmented_image = segmented_image.reshape(image.shape)
```

    (699392, 3)



```python
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(segmented_image, cv2.COLOR_Lab2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_33_0.png)
‚Äã    


### –õ–∏—Å—Ç–∏–Ω–≥ 3. –¢–µ–∫—Å—Ç—É—Ä–Ω–∞—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è

–ü—Ä–∏ —Ç–µ–∫—Å—Ç—É—Ä–Ω–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è —Ç–µ–∫—Å—Ç—É—Ä—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–∞: 
—Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π, 
—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∏ 
—Å–ø–µ–∫—Ç—Ä–∞–ª—å–Ω—ã–π. 
–í –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç–µ –±—É–¥–µ–º —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥, 
–∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç—É—Ä—É —Å–µ–≥–º–µ–Ω—Ç–∞ –∫–∞–∫ –≥–ª–∞–¥–∫—É—é, –≥—Ä—É–±—É—é –∏–ª–∏ –∑–µ—Ä–Ω–∏—Å—Ç—É—é.

–ë—É–¥–µ–º —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ùêº –∫–∞–∫ —Å–ª—É—á–∞–π–Ω—É—é –≤–µ–ª–∏—á–∏–Ω—É ùëß, –∫–æ—Ç–æ—Ä–æ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å 
—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è ùëù(ùëß), –≤—ã—á–∏—Å–ª—è–µ–º–∞—è –∏–∑ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–º –º–æ–º–µ–Ω—Ç–æ–º –ø–æ—Ä—è–¥–∫–∞ ùëõ —Å–ª—É—á–∞–π–Ω–æ–π –≤–µ–ª–∏—á–∏–Ω—ã ùëß 
–Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä ùúáùëõ(ùëß), –≤—ã—á–∏—Å–ª—è–µ–º—ã–π –ø–æ —Ñ–æ—Ä–º—É–ª–µ:

ùúáùëõ(ùëß) = ‚àë ùëù(ùëßùëñ)*(ùëßùëñ ‚àí ùëö)^ùëõ for i = 0 to L‚àí1

–≥–¥–µ ùêø ‚Äî —á–∏—Å–ª–æ —É—Ä–æ–≤–Ω–µ–π –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–µ–π, 
ùëö ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–π –≤–µ–ª–∏—á–∏–Ω—ã ùëß:

ùëö = ‚àë ùëßùëñ*ùëù(ùëßùëñ) for i = 0 to L‚àí1

–ò–∑ —É—Ä–∞–≤–Ω–µ–Ω–∏—è —Å–ª–µ–¥—É–µ—Ç, —á—Ç–æ ùúá0 = 1 –∏ ùúá1 = 0. 
–î–ª—è –æ–ø–∏—Å–∞–Ω–∏—è —Ç–µ–∫—Å—Ç—É—Ä—ã –≤–∞–∂–Ω–∞ –¥–∏—Å–ø–µ—Ä—Å–∏—è —Å–ª—É—á–∞–π–Ω–æ–π –≤–µ–ª–∏—á–∏–Ω—ã, —Ä–∞–≤–Ω–∞—è –≤—Ç–æ—Ä–æ–º—É –º–æ–º–µ–Ω—Ç—É ùúé^2(ùëß) = ùúá2(ùëß) 
–∏ —è–≤–ª—è—é—â–∞—è—Å—è –º–µ—Ä–æ–π —è—Ä–∫–æ—Å—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –≥–ª–∞–¥–∫–æ—Å—Ç–∏. 
–í–≤–µ–¥–µ–º –º–µ—Ä—É –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–π –≥–ª–∞–¥–∫–æ—Å—Ç–∏ ùëÖ:

ùëÖ = 1 ‚àí 1 / (1 + ùúé^2(ùëß)),

–∫–æ—Ç–æ—Ä–∞—è —Ä–∞–≤–Ω–∞ –Ω—É–ª—é –¥–ª—è –æ–±–ª–∞—Å—Ç–µ–π —Å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å—é
(–Ω—É–ª–µ–≤–æ–π –¥–∏—Å–ø–µ—Ä—Å–∏–µ–π) –∏ –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è –∫ –µ–¥–∏–Ω–∏—Ü–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–∏—Å–ø–µ—Ä—Å–∏–π ùúé^2(ùëß). 
–î–ª—è –ø–æ–ª—É—Ç–æ–Ω–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–µ–π [0,255] –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –¥–∏—Å–ø–µ—Ä—Å–∏—é –¥–æ
–∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ [0,1], –ø–æ—Å–∫–æ–ª—å–∫—É –¥–ª—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è –¥–∏—Å–ø–µ—Ä—Å–∏–π –±—É–¥—É—Ç —Å–ª–∏—à–∫–æ–º –≤–µ–ª–∏–∫–∏. 
–ù–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –¥–µ–ª–µ–Ω–∏–µ–º –¥–∏—Å–ø–µ—Ä—Å–∏–∏ ùúé^2(ùëß) –Ω–∞ (ùêø ‚àí 1)2. –í –∫–∞—á–µ—Å—Ç–≤–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
—Ç–µ–∫—Å—Ç—É—Ä—ã —Ç–∞–∫–∂–µ –∑–∞—á–∞—Å—Ç—É—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ:

ùë† = ùúé(ùëß) = sqrt(ùúá2(ùëß))

–¢—Ä–µ—Ç–∏–π –º–æ–º–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–æ–π —Å–∏–º–º–µ—Ç—Ä–∏–∏ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã. 

–î–ª—è –æ—Ü–µ–Ω–∫–∏ —Ç–µ–∫—Å—Ç—É—Ä–Ω—ã—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è —ç–Ω—Ç—Ä–æ–ø–∏–∏ ùê∏, 
–æ–ø—Ä–µ–¥–µ–ª—è—é—â–∞—è —Ä–∞–∑–±—Ä–æ—Å –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–µ–π —Å–æ—Å–µ–¥–Ω–∏—Ö –ø–∏–∫—Å–µ–ª–µ–π:

ùê∏ = - ‚àë ùëù(ùëßùëñ)*log2(ùëù(ùëßùëñ)) for i = 0 to L‚àí1

–ï—â–µ –æ–¥–Ω–æ–π –≤–∞–∂–Ω–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–æ–π, –æ–ø–∏—Å—ã–≤–∞—é—â–µ–π —Ç–µ–∫—Å—Ç—É—Ä—É,
—è–≤–ª—è–µ—Ç—Å—è –º–µ—Ä–∞ –æ–¥–Ω–æ—Ä–æ–¥–Ω–æ—Å—Ç–∏ ùëà, –æ—Ü–µ–Ω–∏–≤–∞—é—â–∞—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã:

ùëà = ‚àë ùëù^2(ùëßùëñ) for i = 0 to L‚àí1

–ü–æ—Å–ª–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∫–∞–∫–æ–≥–æ-–ª–∏–±–æ –ø—Ä–∏–∑–Ω–∞–∫–∞ –∏–ª–∏ –Ω–∞–±–æ—Ä–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –±–∏–Ω–∞—Ä–Ω—É—é –º–∞—Å–∫—É, –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ—Ç–æ—Ä–æ–π –∏ –±—É–¥–µ—Ç
–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Ç–µ–∫—Å—Ç—É—Ä–Ω–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–Ω—Ç—Ä–æ–ø–∏—é ùê∏ –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ –ø–∏–∫—Å–µ–ª—è (ùë•,ùë¶).

–°—Ç—Ä–∞–Ω–Ω–æ, —á—Ç–æ –º–æ–º–µ–Ω—Ç—ã –∏ –º–µ—Ä–∞ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –≤ python —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –∫–∞–∫ –º–µ—Ç—Ä–∏–∫–∞, –Ω–æ –Ω–µ –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—è –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏.
–ë—ã–ª–æ –±—ã —É–¥–æ–±–Ω–æ —Å–æ–∑–¥–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ç–∞–∫–∏—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–µ–π, –æ–Ω–∏, –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏, –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ª—É—á—à–µ
—Å–≤—ë—Ç—Ä–æ—á–Ω—ã—Ö –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π –∏–∑-–∑–∞ —Å–≤–æ–µ–π –Ω–µ–ª–Ω–µ–π–Ω–æ—Å—Ç–∏.


```python
image = np.float32(cv2.cvtColor(cv2.imread("data/texture_segmentation/texture_segmentation_5.jpg"), cv2.COLOR_BGR2GRAY) / 255.0)
image_colored = cv2.imread("data/texture_segmentation/texture_segmentation_5.jpg")
```


```python
# –ò—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image, cv2.COLOR_GRAY2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_36_0.png)
‚Äã    



```python
# –ü–æ–ª—É—á–µ–Ω–∏–µ –≠–Ω—Ç—Ä–æ–ø–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
image_entropy = np.float32(skimage.filters.rank.entropy(image, skimage.morphology.disk(17)))

# –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≠–Ω—Ç—Ä–æ–ø–∏–∏
image_entropy -= np.min(image_entropy)
image_entropy /= np.max(image_entropy)

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≠–Ω—Ç—Ä–æ–ø–∏–∏
# cv2.imwrite("data/texture_segmentation/texture_segmentation_5_entropy.jpg", cv2.cvtColor(image_entropy * 255, cv2.COLOR_GRAY2BGR))
```


```python
# –≠–Ω—Ç—Ä–æ–ø–∏—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(image_entropy, cv2.COLOR_GRAY2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_38_0.png)
‚Äã    



```python
t1 = 0.31
t2 = 0.62

# –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –≠–Ω—Ç—Ä–æ–ø–∏–∏ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ —Ä—É—á–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –æ–±–ª–∞—Å—Ç–µ–π
if use_graph:
    figure(figsize=(9, 6), dpi=80)
    plt.hist(image_entropy.ravel(),256,[0.0,1.0])
    plt.axvline(t1, color='k', ls='--')
    plt.axvline(t2, color='k', ls='--')
    plt.tight_layout()
    plt.show()
```


‚Äã    
![png](output_39_0.png)
‚Äã    



```python
pixel_values = np.float32(image_entropy.reshape((-1, 3)))
print(pixel_values.shape)
criteria = (cv2.TERM_CRITERIA_EPS + cv2.TERM_CRITERIA_MAX_ITER, 200, 0.0001)
k = 3 # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Å–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞
_, labels, (centers) = cv2.kmeans(pixel_values, k, None, criteria, 100, cv2.KMEANS_RANDOM_CENTERS)
centers = np.float32(centers)
labels = labels.flatten()
segmented_image = centers[labels.flatten()]
segmented_image = segmented_image.reshape(image_entropy.shape)
centers = centers[:,0]
centers = sorted(centers)
t1 = 0.5 * (centers[0] + centers[1])
t2 = 0.5 * (centers[1] + centers[2])
print(f"t1 = {t1}\nt2 = {t2}")
```

    (728320, 3)
    t1 = 0.3163999021053314
    t2 = 0.6737664937973022



```python
# –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –≠–Ω—Ç—Ä–æ–ø–∏–∏ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ —Ä–∞–∑–¥–µ–ª–∞ –æ–±–ª–∞—Å—Ç–µ–π –º–µ—Ç–æ–¥–æ–º k-—Å—Ä–µ–¥–Ω–∏—Ö
if use_graph:
    figure(figsize=(9, 6), dpi=80)
    plt.hist(image_entropy.ravel(),256,[0.0,1.0])
    plt.axvline(t1, color='k', ls='--')
    plt.axvline(t2, color='k', ls='--')
    plt.tight_layout()
    plt.show()
```


‚Äã    
![png](output_41_0.png)
‚Äã    



```python
# –°–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≠–Ω—Ç—Ä–æ–ø–∏—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    plt.imshow(cv2.cvtColor(segmented_image, cv2.COLOR_GRAY2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_42_0.png)
‚Äã    


–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã (–±—É–¥—É—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã –ø–æ–¥—Ä–æ–±–Ω–µ–µ –≤ —Ä–∞–±–æ—Ç–µ ‚Ññ6) —Å–Ω–∞—á–∞–ª–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å–≤—è–∑–Ω—ã—Ö 
–æ–±–ª–∞—Å—Ç–µ–π, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö –º–µ–Ω–µ–µ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–∏–∫—Å–µ–ª–µ–π (—Ñ—É–Ω–∫—Ü–∏—è skimage.morphology.remove_small_objects()), 
–∞ –∑–∞—Ç–µ–º –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –¥–µ—Ñ–µ–∫—Ç–æ–≤ —Ñ–æ—Ä–º—ã –∏–ª–∏ ¬´–¥—ã—Ä–æ–∫¬ª, —Ç–∞–∫–∂–µ —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö –º–µ–Ω–µ–µ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–∏–∫—Å–µ–ª–µ–π 
(—Ñ—É–Ω–∫—Ü–∏—è skimage.morphology.remove_small_holes()).


```python
segmented_image = np.uint8(np.round(segmented_image * 255))
masks = []
classes = list(zip(*np.unique(segmented_image, return_counts=True)))
classes = sorted(classes, key=lambda tup: tup[1])
classes = [tup[0] for tup in classes]
for class_value in classes:
    masks.append((segmented_image == class_value))
for i in range(len(masks)):
    masks[i] = skimage.morphology.remove_small_objects(
        masks[i], 
        min_size=int(0.05 * np.multiply(*image.shape[:2])), 
        connectivity=2
    )
    masks[i] = skimage.morphology.remove_small_holes(
        masks[i], 
        area_threshold=int(0.01 * np.multiply(*image.shape[:2])), 
        connectivity=2
    )
```


```python
# –ú–∞—Å–∫–∏ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
if use_graph:
    figure(figsize=(32, 16), dpi=80)
    masks_all = None
    for mask in masks:
        if masks_all is None:
            masks_all = np.uint8(mask * 255)
        else:
            masks_all = cv2.hconcat([masks_all, np.uint8(mask * 255)])
    plt.imshow(cv2.cvtColor(masks_all, cv2.COLOR_GRAY2RGB))
    plt.xticks([]),plt.yticks([])
    plt.show()
```


‚Äã    
![png](output_45_0.png)
‚Äã    



```python
# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ (–Ω–µ–±–æ, –≤–æ–¥–∞, —Å—É—à–∞)
if use_graph:
    for mask in masks:
        figure(figsize=(32, 16), dpi=80)
        plt.imshow(cv2.cvtColor(cv2.bitwise_and(image_colored, image_colored, mask=np.uint8(mask * 255)), cv2.COLOR_BGR2RGB))
        plt.xticks([]),plt.yticks([])
        plt.show()
```


‚Äã    
![png](output_46_0.png)
‚Äã    




![png](output_46_1.png)
    




![png](output_46_2.png)
    


–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –æ—Ü–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ–∫—Å—Ç—É—Ä—ã:

1. –°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–π –≤–µ–ª–∏—á–∏–Ω—ã
2. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ (–∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–π –∫–æ—Ä–µ–Ω—å –∏–∑ –≤—Ç–æ—Ä–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞)
3. R - –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è –≥–ª–∞–¥–∫–æ—Å—Ç—å
4. –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ —Å–∏–º–º–µ—Ç—Ä–∏–∏ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã (—Ç—Ä–µ—Ç–∏–π —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –º–æ–º–µ–Ω—Ç)
5. –û–¥–Ω–æ—Ä–æ–¥–Ω–æ—Å—Ç—å –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã
6. –≠–Ω—Ç—Ä–æ–ø–∏—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã


```python
texture_names = ["–Ω–µ–±–∞", "–≤–æ–¥—ã", "–∑–µ–º–ª–∏"]
textures = []
for mask in masks:
    textures.append({})
    textures[-1]["array"] = image[mask]
    textures[-1]["array_int"] = np.uint8(np.round(textures[-1]["array"] * 255))
    textures[-1]["histogram"] = np.histogram(textures[-1]["array_int"],256,[0,256])[0]
    textures[-1]["probability"] = np.float32(textures[-1]["histogram"]) / \
                                  np.float32(np.sum(textures[-1]["histogram"][textures[-1]["array_int"]]))
    textures[-1]["–°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–π –≤–µ–ª–∏—á–∏–Ω—ã"] = np.sum(
            textures[-1]["array_int"] * textures[-1]["probability"][textures[-1]["array_int"]]
    )
    textures[-1]["–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ"] = np.sqrt(np.sum(
            ((textures[-1]["array_int"] - textures[-1]["–°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–π –≤–µ–ª–∏—á–∏–Ω—ã"]) ** 2) *
            textures[-1]["probability"][textures[-1]["array_int"]]
    ))
    textures[-1]["R - –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è –≥–ª–∞–¥–∫–æ—Å—Ç—å"] = \
        1.0 - 1.0 / (1 + (textures[-1]["–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ"] ** 2) / ((255 - 1) ** 2))
    textures[-1]["–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ —Å–∏–º–º–µ—Ç—Ä–∏–∏ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã"] = np.sum(
            ((textures[-1]["array_int"] - textures[-1]["–°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–π –≤–µ–ª–∏—á–∏–Ω—ã"]) ** 3) *
            textures[-1]["probability"][textures[-1]["array_int"]]
    )
    textures[-1]["–û–¥–Ω–æ—Ä–æ–¥–Ω–æ—Å—Ç—å –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã"] = np.sum(
            textures[-1]["probability"][textures[-1]["array_int"]] ** 2
    )
    textures[-1]["–≠–Ω—Ç—Ä–æ–ø–∏—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã"] = - np.sum(
            textures[-1]["probability"][textures[-1]["array_int"]] *
            np.log2(textures[-1]["probability"][textures[-1]["array_int"]])
    )
```


```python
for index in range(len(textures)):
    print(f"\n\n=== {index} —Ç–µ–∫—Å—Ç—É—Ä–∞ {texture_names[index]} ===")
    n = 0
    for key, value in textures[index].items():
        if key in ["array", "array_int", "probability", "histogram"]:
            continue
        n += 1
        print(f"{n}. {key} = {'{0:.10f}'.format(value)}")
```


‚Äã    
    === 0 —Ç–µ–∫—Å—Ç—É—Ä–∞ –Ω–µ–±–∞ ===
    1. –°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–π –≤–µ–ª–∏—á–∏–Ω—ã = 253.8486175537
    2. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ = 0.6053602695
    3. R - –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è –≥–ª–∞–¥–∫–æ—Å—Ç—å = 0.0000056801
    4. –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ —Å–∏–º–º–µ—Ç—Ä–∏–∏ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã = -0.5859925151
    5. –û–¥–Ω–æ—Ä–æ–¥–Ω–æ—Å—Ç—å –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã = 0.0000105246
    6. –≠–Ω—Ç—Ä–æ–ø–∏—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã = 16.6777133942


‚Äã    
    === 1 —Ç–µ–∫—Å—Ç—É—Ä–∞ –≤–æ–¥—ã ===
    1. –°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–π –≤–µ–ª–∏—á–∏–Ω—ã = 167.7429504395
    2. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ = 26.3628025055
    3. R - –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è –≥–ª–∞–¥–∫–æ—Å—Ç—å = 0.0106576710
    4. –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ —Å–∏–º–º–µ—Ç—Ä–∏–∏ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã = -33576.6054687500
    5. –û–¥–Ω–æ—Ä–æ–¥–Ω–æ—Å—Ç—å –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã = 0.0000015498
    6. –≠–Ω—Ç—Ä–æ–ø–∏—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã = 19.4059734344


‚Äã    
    === 2 —Ç–µ–∫—Å—Ç—É—Ä–∞ –∑–µ–º–ª–∏ ===
    1. –°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–π –≤–µ–ª–∏—á–∏–Ω—ã = 163.2591247559
    2. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ = 34.9334793091
    3. R - –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è –≥–ª–∞–¥–∫–æ—Å—Ç—å = 0.0185642801
    4. –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ —Å–∏–º–º–µ—Ç—Ä–∏–∏ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã = -46043.3203125000
    5. –û–¥–Ω–æ—Ä–æ–¥–Ω–æ—Å—Ç—å –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã = 0.0000010090
    6. –≠–Ω—Ç—Ä–æ–ø–∏—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã = 20.0188026428

